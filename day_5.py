import time
import os

protocols = '''98,22,35,93,25,67,78,13,75,21,18,51,17,33,55,45,64,31,96,29,65
41,43,66,36,91,15,98,25,67,78,75
66,91,22,15,18,98,76,13,78,42,93,67,95,35,17,33,36,25,59,12,21,75,57
89,83,99,54,41,57,66,59,91,42,95,15,98,93,25
87,11,92,46,89,83,53,81,57,66,91
78,75,51,64,65,16,71
31,37,96,29,87,65,11,92,46,71,83,81,66
21,51,17,29,92,71,89
17,87,86,11,82,92,46,71,53,88,54
86,11,82,46,16,83,53,99,41,43,81,66,59,76,91,12,42
43,66,91,75,41,12,98,59,76,25,18,95,22,35,15
43,66,59,76,91,67,13,75,21,18,51
57,59,76,36,91,12,95,15,22,35,93,25,67,78,13,75,18,51,33
35,93,67,75,18,55,96,87,86,11,82
43,92,71,76,57,88,53,82,81,86,41,12,16,66,89,46,99,65,11,36,54,59,83
37,21,51,92,45,89,13,64,71,11,18
42,15,22,35,78,18,51,17,33,64,31,96,29
51,17,33,64,31,37,96,29,87,86,11,82,46,16,71,83,53,99,88
37,96,25,13,18
53,81,88,66,96,86,87,16,71,43,57,37,29,99,83,82,46,59,11,65,92
59,12,43,99,76,66,53,82,16,92,54,15,41,81,71,89,88,46,57
76,42,91,71,54,81,88,12,41,53,57,83,43,66,11,82,16,92,59,89,95
96,31,35,98,45,64,55,18,13,75,12,42,21,95,33,51,78,17,22
95,35,33,51,22,91,12,78,66,93,59,75,18,55,15,36,42
43,35,93,95,81,42,41
16,71,89,99,88,41,59,36,91,12,95,98,35
55,53,82,64,45,21,31
95,33,35,13,36,25,51,22,91,15,98,31,45,93,42
36,22,93,89,95,99,88,57,42,12,66,35,53,98,25,91,83,54,76,81,59
76,53,11,43,59,99,95,92,81,12,46,88,91
35,25,67,17,33,45,96,65,11
42,95,15,98,22,35,93,25,67,78,13,75,21,51,17,33,45,64,31,96,29
13,75,21,17,45,64,96,87,82,92,16,71,89
71,89,83,53,99,88,54,41,66,76,42,95,15,98,22,35,93
45,64,31,29,87,82,46,54,81
36,98,66,83,93,57,25,91,43,12,22,99,35,95,89,15,42,76,41
21,51,17,64,29,11,89
55,78,93,21,92,45,29,13,86
91,43,83,76,81,53,16,71,92,57,82,46,54
16,99,41,81,91,42,35
67,21,25,45,13,12,42,22,33,17,55,93,18,15,91,78,59
59,36,91,12,42,95,15,98,22,35,67,78,13,75,21,18,51,17,33,55,45
41,65,36,91,11,99,66,89,76,86,92,43,54,16,82,81,12
82,54,65,66,81,86,88,11,71,43,29,53,46,36,57,59,92,89,16
46,16,65,87,66,88,36,71,57,89,99,81,11,43,29
81,46,76,71,54,43,89,96,29,53,66,88,99,41,57
12,18,15,36,95,75,66,91,41,21,42,59,35
82,64,65,18,45,29,11,67,51,87,78,25,21
67,21,17,33,64,31,65,11,82,46,16
33,91,93,67,76,75,95,55,42,35,78,64,51
22,59,95,66,81,21,15,43,42,67,51,93,18,25,57
99,88,54,41,43,81,57,66,59,76,91,12,42,15,98,22,35,93,25,67,13
25,67,78,13,75,18,17,33,55,45,31,96,87,65,11,82,46
35,67,12,21,81,75,76,93,59,36,17,98,42
91,25,88,59,36,12,89
12,22,36,93,81,66,35,57,15,91,76,95,88,25,98,99,89,43,54
67,78,13,75,21,17,55,45,31,37,29,65,11,82,46
25,67,78,75,51,31,96,29,65,86,82,92,46
78,65,45,33,15,17,55,13,25,67,87,35,37,64,21,18,31
98,41,92,54,71,66,91,57,99,43,83,46,15
98,51,36,33,75,64,93,31,95,67,22,18,12
87,86,92,71,89,53,99,88,54,41,81,57,59,36,91
66,83,22,53,88
17,59,35,33,45,18,25,95,42,51,15,21,13,75,67,98,22,55,91,78,76,93,12
21,75,55,17,66,12,15,22,93,59,98
81,57,66,59,76,36,91,12,42,95,15,98,22,35,93,67,78,13,75,21,18,51,17
12,98,22,25,67
86,11,82,46,16,83,53,99,88,54,41,57,66,59,36,91,42
35,67,78,13,75,21,18,51,17,33,55,45,64,31,37,96,29,87,65,11,82
92,46,71,53,99,43,57,59,76,91,12
95,15,98,22,35,93,25,67,13,75,21,18,51,17,33,55,45,64,31,37,96,29,87
36,16,81,66,83,46,53,88,57,54,12,11,41,89,76,95,71
12,81,53,42,83,89,99,82,66,71,92,76,16,59,11,91,95,54,88
36,57,76,13,33,21,12,18,95
87,65,86,82,46,16,71,89,53,88,54,41,43,81,66,59,76,36,91
76,42,35,93,25,13,75,21,18,51,64
21,18,17,55,45,37,29,65,92,16,53
25,67,18,92,93,33,31
15,93,13,31,37,96,65
42,35,93,67,75,18,45,64,96
78,31,29,64,15,33,42,37,17,96,75
41,54,25,42,59,53,36,88,91,67,57,22,15,95,78
55,64,37,96,92,16,71,83,53,54,43
99,96,11,46,51,89,86,37,33,31,55,64,53,71,45
81,66,59,12,95,22,35,67,78,13,21,18,17
76,81,95,15,98,75,57,13,88,66,22
53,93,15,83,57,91,66,42,22,99,59,67,88,25,54
45,64,37,29,86,11,46,16,89,83,88,43,81
96,12,25,15,98,95,35
64,51,15,22,45,12,93,91,25,13,17,18,42,78,55,36,76,75,98,35,67,33,95
93,25,67,33,31,86,92
17,33,55,45,64,31,37,29,87,65,86,11,82,92,46,16,71,89,83,53,99,88,54
98,46,81,89,71,57,54,88,92,42,95,12,16,76,41
92,11,57,99,29,37,59,41,53,65,87,71,16,82,81,86,96,66,43,88,46,83,89
33,45,31,37,96,29,87,65,86,82,92,46,16,71,89,53,99,88,41
65,86,11,92,46,88,81,91,12
15,98,22,35,93,25,67,78,13,75,21,18,51,17,33,55,45,64,31,96,29,87,65
86,41,43,87,65,54,59,92,11
66,59,76,36,15,98,22,25,67,78,13,21,18,17,55
35,75,76,42,95,54,21,13,57
17,55,45,64,31,37,96,29,87,65,86,11,82,92,46,16,71,89,83,53,99,88,54
66,59,76,36,91,12,42,95,15,98,22,35,93,25,67,78,75,21,18,51,17,33,55
59,54,71,43,91,12,76,81,83,46,36,16,53,57,41,88,92,82,11
29,75,17,37,13,22,65,67,78,18,55,93,21
41,57,66,59,76,91,98,22,35,67,78,13,18
87,65,86,11,92,46,16,71,89,53,88,54,41,43,81,57,59,76,91
76,91,12,95,22,93,25,67,75,17,64
35,13,75,18,33,37,96,65,82
18,65,87,67,35,55,29,45,13,93,51,86,78,96,11,21,64,33,22,17,75,37,25
25,29,21,75,22,37,33,67,55,11,18,86,51
16,71,89,53,99,88,54,43,81,59,76,36,91,12,95,15,98,22,35
25,11,13,65,29,17,46,86,75,92,96
65,11,82,16,71,83,53,66,12
95,98,93,51,96
67,13,75,21,18,51,17,33,64,37,96,29,87,65,86,11,82,46,16
81,57,66,59,36,91,42,15,35,25,67,75,21
12,57,88,42,53,98,78,36,22,43,15,91,35,99,25,54,95,41,76
57,91,15,98,22,35,93,67,78,13,75,17,33
41,89,15,81,98,54,57,35,43,36,91,95,71,53,12,83,76,66,42,59,93
46,17,16,65,18,99,86,29,71,89,82,96,83,51,53,55,87
95,42,15,18,41,75,22,36,59,93,21
37,45,29,92,31,16,18,51,86,75,17,55,82,67,13,78,46
81,59,76,36,91,42,15,98,22,35,25,78,13,75,18,51,17
65,45,55,17,18,78,31,93,64,51,87,67,35,75,22,29,86,96,33,25,98
92,46,71,89,83,53,99,88,54,43,81,57,66,59,76,36,91,12,42,15,98
54,59,53,82,87,36,86,88,99,81,41,11,89,92,46
33,17,89,45,46,92,53,51,87,18,55,11,64,37,65
78,21,51,64,37,87,65,11,46,16,71
76,36,12,42,95,15,22,93,25,67,78,13,51,17,33,45,64
41,96,29,88,89,65,76
15,98,22,35,93,25,67,78,13,75,21,18,51,33,55,45,64,31,37,96,29,87,65
82,46,71,53,99,54,41,81,12,95,15
45,11,88,54,92,46,96,29,86,81,41
41,15,88,83,54,98,43,67,22,93,76,42,53,25,99
87,22,17,51,55,86,25,96,13,45,29,31,65,64,35,93,21
18,64,93,55,17,95,98,45,15,13,36,12,78,75,91,76,25
22,35,93,25,67,78,75,21,18,51,33,45,64,31,37,96,29,87,65,86,11
71,89,99,88,54,41,43,81,57,59,76,91,12,98,22,35,93
13,81,93,21,42,66,25,35,67,95,91,17,36
95,89,22,15,66,25,76
95,22,35,67,64,29,87
18,51,17,33,55,45,64,96,29,87,65,86,11,82,92,46,71,89,83,53,99
41,36,57,91,59,66,42,99,82,43,88,92,83,71,15,16,95,89,54
36,22,35,93,25,67,78
41,81,59,93,25
95,15,98,22,35,93,25,13,75,21,51,17,33,55,45,31,37,96,29
16,71,46,53,92,41,66,54,65,89,29,86,59,43,82,81,36,83,99,76,88
29,93,51,55,33
51,64,87,86,11,83,88
53,46,95,76,88,22,89,99,91,81,83
81,76,57,15,42
89,53,99,57,59
64,37,96,29,87,86,82,92,46,83,54,41,43,81,57
71,92,89,57,53,31,43,66,16
81,12,98,35,67,78,17
46,71,89,83,53,99,41,43,57,66,12,42,95,15,22
57,66,59,76,36,91,12,42,15,98,22,35,93,25,13,75,18,51,33
29,13,17,11,37,92,65,55,75
99,36,86,53,11,12,54,46,82,59,89,42,92,16,57,88,91,66,41,83,43
75,18,17,33,55,45,64,31,37,96,29,87,65,86,11,82,92,46,16,89,83
12,42,95,15,35,93,25,67,13,17,33,64,31,37,96
92,46,71,83,88,54,41,81,59,76,98
51,17,33,55,45,64,31,37,29,87,65,86,11,82,92,46,16,71,89,83,53,99,88
59,46,16,12,42,82,36,43,83,57,99,95,11,71,92,54,53,41,89,91,66
93,25,67,13,75,21,18,51,55,45,64,31,37,96,87,65,11,82,92
91,42,98,93,25,78,13,21,51
82,86,17,33,45,89,65,31,71,16,29,11,13
43,81,57,66,59,36,91,15,21
31,92,16,89,83,41,66
95,15,98,22,93,25,67,78,13,75,21,18,51,17,33,55,45,64,31,37,96,29,87
46,54,87,43,89,88,66,71,83,96,41,31,65
82,95,12,15,36,91,89
59,15,66,12,89
87,54,64,96,11,46,37,92,16,41,53,89,33,45,29,31,99,82,55
55,45,64,31,37,96,29,87,65,86,11,46,16,89,83,53,99,54,43
17,33,55,45,64,31,37,96,29,87,86,11,82,92,46,16,71,89,83,53,99,88,54
67,13,22,29,21,33,45,31,55,95,25,15,17,51,37
43,81,57,66,59,76,91,12,42,95,15,35,93,67,13,75,21,18,51
18,17,33,55,45,64,31,37,96,29,87,65,86,11,82,92,16,89,83,53,99
22,57,75,15,78,43,21,41,18,42,13,36,67,91,76
53,71,16,11,57,92,64,29,88,54,43,96,86,89,81,46,31
91,12,95,15,22,93,78,13,51,17,33,64,37
59,76,36,91,12,42,95,15,98,22,35,25,67,75,21,18,51,17,33,55,45
46,16,71,89,83,53,99,41,43,81,57,59,76,36,91,12,95,98,22
83,53,99,88,54,41,57,66,76,36,91,12,95,15,98,22,93,25,67
75,21,18,51,17,33,55,64,31,37,96,87,65,86,11,82,92,46,16,71,83
64,43,71,53,81,31,65,37,92
46,42,66,15,59,95,53,99,81,71,83,76,91,54,92,36,89,88,57,16,43
15,51,35,78,55,33,95,67,45,31,21,18,29,22,17,75,37,64,13,98,96
53,99,88,54,41,43,57,66,59,12,95,15,98,22,93,67,78
11,82,46,16,71,89,83,53,99,88,54,41,43,81,57,66,59,76,36,91,12,42,95
33,71,55,21,65,45,86,37,29,13,11,87,75,46,78,18,51
96,17,51,88,33,89,92,83,46
43,54,36,53,71,92,83,76,89,66,46,99,29
89,99,88,17,11,86,82,83,46,33,55,64,96,87,31,54,53
78,18,45,65,93,87,29,31,13,25,11,92,82,51,55,86,96,37,64'''

protocols_test='''75,47,61,53,29
97,61,53,29,13
75,29,13
75,97,47,61,53
61,13,29
97,13,75,29,47'''

start_p1 = time.time()
file = open(os.path.join(os.path.dirname(os.path.abspath(__file__)), r"inputs\Day 5"), 'r')
proceeding_rules = {}
for l in file:
    key = int(l.split("|")[0])
    val = int(l.split("|")[1])
    if key in proceeding_rules.keys():
        proceeding_rules[key].add(val)
    else:
        proceeding_rules[key] = set()
        proceeding_rules[key].add(val)

middle_numbers = []
for protocol in protocols.split("\n"):
    pages = [int(i) for i in list(protocol.split(","))]
    check_flags = []
    for i in range(0, len(pages)-1):
        curr = pages[i]
        if curr in proceeding_rules.keys():
            check_flags.append(set(pages[i+1:len(pages)]).issubset(set(proceeding_rules[curr])))
        else:
            check_flags.append(len(pages[i+1:len(pages)]) == 0)
    if all(check_flags):
        middle_numbers.append(pages[len(pages) // 2])

end_p1 = time.time()

print("Part 1 result: {}".format(sum(middle_numbers)))
print("The time of execution of above program is :", (end_p1 - start_p1) * 10**3, "ms")
print()

